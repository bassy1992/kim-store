<!DOCTYPE html>
<html>
<head>
    <title>Debug Cart</title>
</head>
<body>
    <h1>Debug Cart Operations</h1>
    <div id="results"></div>
    
    <script>
        async function debugCart() {
            const results = document.getElementById('results');
            const railwayUrl = 'https://web-production-0b12.up.railway.app';
            let html = '<h2>Cart Debug Test</h2>';
            
            try {
                // Step 1: Get initial cart
                console.log('Step 1: Get initial cart');
                const getCart1 = await fetch(`${railwayUrl}/api/cart/`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const cart1 = await getCart1.json();
                console.log('Initial cart:', cart1);
                html += `<p><strong>Initial cart items:</strong> ${cart1.items?.length || 0}</p>`;
                
                // Step 2: Add item to cart
                console.log('Step 2: Add item to cart');
                const addResponse = await fetch(`${railwayUrl}/api/cart/items/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_id: 1,
                        quantity: 1,
                        size: '50ml'
                    })
                });
                const addResult = await addResponse.json();
                console.log('Add response:', addResult);
                html += `<p><strong>Add response status:</strong> ${addResponse.status}</p>`;
                html += `<p><strong>Items after add:</strong> ${addResult.items?.length || 0}</p>`;
                
                // Step 3: Get cart again
                console.log('Step 3: Get cart again');
                const getCart2 = await fetch(`${railwayUrl}/api/cart/`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const cart2 = await getCart2.json();
                console.log('Cart after add:', cart2);
                html += `<p><strong>Cart items after refresh:</strong> ${cart2.items?.length || 0}</p>`;
                
                // Step 4: Check debug info
                console.log('Step 4: Get debug info');
                const debugResponse = await fetch(`${railwayUrl}/api/cart/debug/`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const debugInfo = await debugResponse.json();
                console.log('Debug info:', debugInfo);
                html += `<p><strong>Debug info:</strong> ${JSON.stringify(debugInfo, null, 2)}</p>`;
                
                results.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                results.innerHTML = `<h2>‚ùå Error</h2><p>${error.message}</p>`;
            }
        }
        
        debugCart();
    </script>
</body>
</html>